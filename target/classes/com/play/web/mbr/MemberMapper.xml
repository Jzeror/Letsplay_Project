<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.play.web.mbr.MemberMapper">

<resultMap id="hjResult" type="hashmap">
	<result property="member_id" column="MEMBER_ID"/>
	<result property="res_no" column="RES_NO"/>
	<result property="accom_name" column="ACCOM_NAME"/>
	<result property="room_no" column="ROOM_NO"/>
	<result property="accom_addr" column="ACCOM_ADDR"/>
	<result property="pay_date" column="PAY_DATE"/>
	<result property="checkin_date" column="CHECKIN_DATE"/>
	<result property="checkout_date" column="CHECKOUT_DATE"/>
	<result property="pay_price" column="PAY_PRICE"/>
	<result property="pay_type" column="PAY_TYPE"/>
</resultMap>

 <select id="rlist" resultMap="hjResult">
	 SELECT R.RES_NO,
	       A.ACCOM_NAME,
	       O.ROOM_NO,
	       A.ACCOM_ADDR,
	       P.PAY_DATE,
	       CONCAT(R.CHECKIN_DATE, ",", DAYNAME(R.CHECKIN_DATE))
	          AS CHECKIN_DATE,
	       CONCAT(R.CHECKOUT_DATE, ",", DAYNAME(R.CHECKOUT_DATE))
	          AS CHECKOUT_DATE,
	       P.PAY_PRICE,
	       P.PAY_TYPE
	FROM PAYMENT P
	     JOIN RESERVATION R ON P.PAY_NO = R.PAY_NO
	     JOIN ROOM O ON O.ROOM_SEQ = R.ROOM_SEQ
	     JOIN ACCOMMODATION A ON A.ACCOM_SEQ = O.ACCOM_SEQ
	WHERE MEMBER_ID LIKE #{member_id}
	ORDER BY P.PAY_DATE DESC
 </select>

  <select id="get" resultType="com.play.web.mbr.Member">
    SELECT *
    FROM member
    <where>
    	<if test=" member_id != null and member_id != '' ">
    		MEMBER_ID LIKE #{member_id}
    	</if>
    	<if test=" password != null and password != '' ">
    		AND PASSWORD LIKE #{password}
    	</if>
    </where>
  </select>
  
  <insert id="post" >
  	INSERT INTO member
		(MEMBER_ID, NAME, PASSWORD, BIRTHDATE, GENDER, AGE, PHONE, CUSTOMER_GRADE, NICKNAME, ADDRESS, PROFILEIMG)
		VALUES (#{member_id}, #{name}, #{password}, #{birthdate}, #{gender}, #{age}, #{phone}, #{customer_grade}, #{nickname}, #{address}, #{profileimg})
  </insert>
  <select id="list" resultType="com.play.web.mbr.Member">
    SELECT * 
    FROM member
  </select>
  <select id="count" resultType="int">
  	SELECT COUNT(*) FROM MEMBER
  	<where>
	  	<if test=" member_id != null and member_id != '' ">
	  		MEMBER_ID LIKE #{member_id}
	  	</if>
  	</where>
  </select>
  
  <update id="update" parameterType="com.play.web.mbr.Member">
	  UPDATE member SET
	  	<if test=" nickname != null and nickname != '' ">
    		NICKNAME = #{nickname}
    	</if>
	  	<if test=" password != null and password != '' ">
    		PASSWORD = #{password}
    	</if>
	  	<if test=" phone != null and phone != '' ">
    		PHONE = #{phone}
    	</if>
	  	<if test=" profileimg != null and profileimg != '' ">
    		PROFILEIMG = #{profileimg}
    	</if>
	  WHERE MEMBER_ID LIKE #{member_id}
  </update>
  
  <delete id="delete" parameterType="com.play.web.mbr.Member">
	  DELETE FROM member
	  WHERE MEMBER_ID = #{member_id}
	  AND PASSWORD = #{password}
  </delete>
</mapper>