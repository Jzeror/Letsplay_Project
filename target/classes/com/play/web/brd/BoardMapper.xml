<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.play.web.brd.BoardMapper">
<resultMap id="seinResult" type="hashmap">
	<result property="msg_seq" column="MSG_SEQ"/>
	<result property="msg_title" column="MSG_TITLE"/>
	<result property="msg_photo" column="MSG_PHOTO"/>
	<result property="msg_date" column="MSG_DATE"/>
	<result property="msg_count" column="MSG_COUNT"/>
	<result property="msg_content" column="MSG_CONTENT"/>
	<result property="bookmark_count" column="BOOKMARK_COUNT"/>
	<result property="subscription_count" column="SUBSCRIPTION_COUNT"/>
	<result property="board_depth" column="BOARD_DEPTH"/>
	<result property="board_id" column="BOARD_ID"/>
	<result property="member_id" column="MEMBER_ID"/>
	<result property="pay_no" column="PAY_NO"/>
	<result property="tag" column="TAG"/>
	<result property="like_count" column="LIKE_COUNT"/>
	<result property="reply_count" column="REPLY_COUNT"/>
	<result property="nickname" column="NICKNAME"/>
	<result property="password" column="NICKpasswordNAME"/>
	<result property="birthdate" column="birthdate"/>
	<result property="joindate" column="joindate"/>
	<result property="gender" column="gender"/>
	<result property="age" column="age"/>
	<result property="phone" column="phone"/>
	<result property="customer_grade" column="customer_grade"/>
	<result property="point" column="point"/>
	<result property="address" column="address"/>
	<result property="zipcode" column="zipcode"/>
	<result property="profileimg" column="profileimg"/>
</resultMap>

  <insert id="write">
   INSERT INTO board (MSG_TITLE, MSG_CONTENT, BOARD_ID, MEMBER_ID, TAG)
   VALUES (#{msg_title}, #{msg_content}, #{board_id}, #{member_id}, #{tag}) 
  </insert>
  
  <select id="list" resultMap="seinResult">
	SELECT *
       FROM (
           SELECT
               ROW_NUMBER() OVER(ORDER BY msg_seq DESC) AS NUM,
               a.*, m.NICKNAME
           FROM board a
           	JOIN member m
           	ON A.MEMBER_ID = M.MEMBER_ID
           WHERE board_depth like 0
           AND board_id like #{board_id}
       )B
       WHERE B.NUM BETWEEN #{beginRow} AND #{endRow}
       ORDER BY B.NUM
  </select>
  
  <select id="read" resultMap="seinResult">
  	SELECT a.*, m.nickname
  	FROM board a
	  	JOIN member m
	    ON a.MEMBER_ID = m.MEMBER_ID
  	WHERE MSG_SEQ like #{msg_seq}
  </select>
  
  <update id="modify">
  	UPDATE board SET MSG_TITLE=#{msg_title}, MSG_CONTENT=#{msg_content}, TAG=#{tag}
  	WHERE BOARD_ID LIKE #{board_id}
  	AND MSG_SEQ LIKE #{msg_seq}
  </update>
  
  <delete id="delete">
  	DELETE FROM board
  	WHERE BOARD_ID LIKE #{board_id}
  	AND MSG_SEQ LIKE #{msg_seq}
  </delete>
  
  <insert id="reWrite">
  	INSERT INTO board (MSG_CONTENT, BOARD_DEPTH, BOARD_ID, MEMBER_ID)
  	VALUES (#{msg_content}, #{msg_seq}, #{board_id}, #{member_id})
  </insert>
  
  <select id="reply" resultType="com.play.web.brd.Board">
	SELECT *
       FROM (
           SELECT
               ROW_NUMBER() OVER(ORDER BY msg_seq DESC) AS NUM,
               A.*
           FROM
               board A
           WHERE board_depth like #{board_depth}
           AND board_id like #{board_id}
       )B
  </select>
  
  <update id="reModify">
  	UPDATE board SET MSG_CONTENT=#{msg_content}
  	WHERE BOARD_DEPTH LIKE #{board_depth}
  	AND BOARD_ID LIKE #{board_id}
  	AND MSG_SEQ LIKE #{msg_seq}
  </update>
  
  <delete id="reDelete">
  	DELETE FROM board 
  	WHERE BOARD_DEPTH LIKE #{board_depth}
  	AND BOARD_ID LIKE #{board_id}
  	AND MSG_SEQ LIKE #{msg_seq}
  </delete>
    
  <select id="count" resultType="int">
  	SELECT COUNT(*) FROM board
  	WHERE board_depth like 0
  </select>
  
  <update id="readInc">
  	UPDATE board SET MSG_COUNT=MSG_COUNT+1
  	WHERE MSG_SEQ LIKE #{msg_seq}
  </update>
  
  <update id="likeInc">
  	UPDATE board SET LIKE_COUNT=LIKE_COUNT+1
  	WHERE MSG_SEQ LIKE #{msg_seq}
  </update>
  
  <update id="likeDes">
  	UPDATE board SET LIKE_COUNT=LIKE_COUNT-1
  	WHERE MSG_SEQ LIKE #{msg_seq}
  </update>
  
  <insert id="room">
  	INSERT INTO ROOM (ACCOM_SEQ, ROOM_NAME, ROOM_NO, ROOM_PRICE)
  	VALUES (#{accom_seq},#{room_name},#{room_no},#{room_price})
  </insert>
</mapper>
